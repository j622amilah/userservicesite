<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
  </head>
  <body>
    
    <!-- HTML -->

    <button id="step0_submit_form_way0" onclick="step0_submit_form_way0()" style='text-align: left;'>step0_submit_form_way0</button>

    <br><br>

    <textarea id="outData0" style='text-align: left;' rows="4" cols="50" placeholder="outData0"></textarea>

    <br><br>

    <button id="read_response_data" onclick="read_response_data()" style='text-align: left;'>read_response_data</button>

    <br><br>

    <textarea id="outData1" style='text-align: left;' rows="4" cols="50" placeholder="outData1"></textarea>

    <br><br>




    <!-- JAVASCRIPT -->
    <script>
      
      // -------------------
      // Start monitoring events as soon as script starts
      // -------------------
      // it seems like it is always running, so I can just start it running at the start of script
      // window.addEventListener("locationchange", function(){ document.getElementById("outData1").innerHTML = window.location.href; });

      // -------------------

      var SCOPES = 'https://www.googleapis.com/auth/bigquery https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/cloud-platform.read-only';

      const API_KEY = "AIzaSyDw0as0jiC_L9W9jqbOJgH7BbO5m0QWaAQ";
      var CLIENT_ID = '982455389157-9o2j34k1qff8cc1apqbec9so842istai.apps.googleusercontent.com';

      var REDIRECT_URI = 'https://j622amilah.github.io/userservicesite/Observations_of_a_Data_Scientist.html';
      // OR
      // var REDIRECT_URI = 'https://script.google.com';

      var CLIENT_SECRET = "";  // for trading in the authorization_code for the access_token

      // -------------------




      // ----------------------------------------
      // STEP 0: call the Google OAuth2 server using GET
      // ----------------------------------------
      function step0_submit_form_way0() {

        // https://developers.google.com/identity/protocols/oauth2/javascript-implicit-flow

        // Google's OAuth 2.0 endpoint for requesting an access token
        var URL = 'https://accounts.google.com/o/oauth2/v2/auth';

        // var returnedurl = window.location.href; 
        // document.getElementById("outData0").innerHTML = returnedurl;
        // https://n-r2pbtrsqsf2gx46eesq7qdxgjigesuvhrdh5waq-0lu-script.googleusercontent.com/userCodeAppPanel

        // ----------------------------------------
        // Create a form using javascript
        // ----------------------------------------
        // Create <form> element to submit parameters to OAuth 2.0 endpoint.
        var form = document.createElement('form');
        form.setAttribute('method', 'GET'); // Send as a GET request.
        form.setAttribute('action', URL);

        // Parameters to pass to OAuth 2.0 endpoint.
        var params = {'client_id': CLIENT_ID, 'response_type': 'token', 'redirect_uri': REDIRECT_URI, 'scope': SCOPES, 'include_granted_scopes': 'true', 'state': 'pass-through value'};

        // Add form parameters as hidden input values.
        for (var p in params) {
          var input = document.createElement('input');

          // input.setAttribute('type', 'visible');
          // input.setAttribute('name', p);
          // input.setAttribute('value', params[p]);
          // OR
          input.innerHTML = '<input type="visible" name='+p+' value='+params[p]+'>';

          form.appendChild(input);
        }
        // Add form to page and submit it to open the OAuth 2.0 endpoint.
        document.body.appendChild(form);
        // ----------------------------------------

        form.submit();

      }

      // -------------------
     

      // ----------------------------------------
      // STEP 2: Read response data from body of page
      // ----------------------------------------
      function read_response_data(){
        
        // -------------------
        // If a GET request is performed: get URL from the refreshed page
        // -------------------

        // Way 0: location.hash.substring(1)
        // No response
        // document.getElementById("outData1").innerHTML = window.location.hash.substring(1);

        // -------------------
        
        // Way 1: 
        document.getElementById("outData1").innerHTML = window.location.href;

        // -------------------

      }





      </script>


  </body>
</html>
